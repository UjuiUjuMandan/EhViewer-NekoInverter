diff --git a/app/build.gradle.kts b/app/build.gradle.kts
index 18c82a9f..f2ef7805 100644
--- a/app/build.gradle.kts
+++ b/app/build.gradle.kts
@@ -159,6 +159,8 @@ dependencies {
     implementation(platform(libs.okhttp.bom))
     implementation(libs.okhttp.coroutines)
     implementation(libs.okhttp.tls)
+    implementation("info.guardianproject.conscrypt:conscrypt-android:2.6.alpha1647601986.job2220801545")
+    implementation("dnsjava:dnsjava:3.6.3")
 
     implementation(libs.okio.jvm)
 
diff --git a/app/proguard-rules.pro b/app/proguard-rules.pro
index 75b419ee..990893be 100644
--- a/app/proguard-rules.pro
+++ b/app/proguard-rules.pro
@@ -12,3 +12,22 @@
 -repackageclasses
 -allowaccessmodification
 -overloadaggressively
+
+# dnsjava
+
+-dontwarn com.sun.jna.Library
+-dontwarn com.sun.jna.Memory
+-dontwarn com.sun.jna.Native
+-dontwarn com.sun.jna.Pointer
+-dontwarn com.sun.jna.Structure$ByReference
+-dontwarn com.sun.jna.Structure$FieldOrder
+-dontwarn com.sun.jna.Structure
+-dontwarn com.sun.jna.WString
+-dontwarn com.sun.jna.platform.win32.Win32Exception
+-dontwarn com.sun.jna.ptr.IntByReference
+-dontwarn com.sun.jna.win32.W32APIOptions
+-dontwarn javax.naming.NamingException
+-dontwarn javax.naming.directory.DirContext
+-dontwarn javax.naming.directory.InitialDirContext
+-dontwarn lombok.Generated
+-dontwarn sun.net.spi.nameservice.NameServiceDescriptor
\ No newline at end of file
diff --git a/app/src/main/java/com/hippo/ehviewer/EhApplication.kt b/app/src/main/java/com/hippo/ehviewer/EhApplication.kt
index 710d68a5..6deccc38 100644
--- a/app/src/main/java/com/hippo/ehviewer/EhApplication.kt
+++ b/app/src/main/java/com/hippo/ehviewer/EhApplication.kt
@@ -35,8 +35,11 @@ import coil3.network.okhttp.asNetworkClient
 import coil3.request.crossfade
 import coil3.serviceLoaderEnabled
 import coil3.util.DebugLogger
+import com.hippo.ehviewer.client.EchRejectedExceptionInterceptor
 import com.hippo.ehviewer.client.EhCookieStore
+import com.hippo.ehviewer.client.EhDns
 import com.hippo.ehviewer.client.EhEngine
+import com.hippo.ehviewer.client.EhSSLSocketFactory
 import com.hippo.ehviewer.client.EhTagDatabase
 import com.hippo.ehviewer.client.data.GalleryDetail
 import com.hippo.ehviewer.coil.DownloadThumbInterceptor
@@ -55,14 +58,18 @@ import com.hippo.util.loadHtml
 import com.hippo.yorozuya.FileUtils
 import com.hippo.yorozuya.IntIdGenerator
 import eu.kanade.tachiyomi.network.interceptor.CloudflareInterceptor
+import java.security.Security
 import java.security.cert.CertificateFactory
 import java.security.cert.X509Certificate
+import javax.net.ssl.SSLContext
+import javax.net.ssl.SSLSocketFactory
 import kotlinx.coroutines.DelicateCoroutinesApi
 import okhttp3.Cache
 import okhttp3.OkHttpClient
 import okhttp3.tls.HandshakeCertificates
 import okio.FileSystem
 import okio.Path.Companion.toOkioPath
+import org.conscrypt.Conscrypt
 
 class EhApplication :
     SceneApplication(),
@@ -249,11 +256,14 @@ class EhApplication :
                 .addPlatformTrustedCertificates()
                 .addTrustedCertificate(cert)
                 .build()
+            val sslSocketFactory: SSLSocketFactory = SSLContext.getInstance("TLS", Conscrypt.newProvider()).apply { init(null, null, null) }.socketFactory
             OkHttpClient.Builder().apply {
                 cookieJar(EhCookieStore)
+                dns(EhDns)
                 proxySelector(ehProxySelector)
-                sslSocketFactory(certs.sslSocketFactory(), certs.trustManager)
+                sslSocketFactory(EhSSLSocketFactory(sslSocketFactory), certs.trustManager)
                 addInterceptor(CloudflareInterceptor(application))
+                addInterceptor(EchRejectedExceptionInterceptor())
             }.build()
         }
 
diff --git a/app/src/main/java/com/hippo/ehviewer/Settings.kt b/app/src/main/java/com/hippo/ehviewer/Settings.kt
index 439884ad..a76f32d1 100644
--- a/app/src/main/java/com/hippo/ehviewer/Settings.kt
+++ b/app/src/main/java/com/hippo/ehviewer/Settings.kt
@@ -170,7 +170,7 @@ object Settings {
     const val KEY_APP_LANGUAGE = "app_language"
     private const val DEFAULT_APP_LANGUAGE = "system"
     private const val KEY_PROXY_TYPE = "proxy_type"
-    private const val DEFAULT_PROXY_TYPE = EhProxySelector.TYPE_SYSTEM
+    private const val DEFAULT_PROXY_TYPE = EhProxySelector.TYPE_DIRECT
     private const val KEY_PROXY_IP = "proxy_ip"
     private val DEFAULT_PROXY_IP: String? = null
     private const val KEY_PROXY_PORT = "proxy_port"
diff --git a/app/src/main/java/com/hippo/ehviewer/client/ECH.kt b/app/src/main/java/com/hippo/ehviewer/client/ECH.kt
new file mode 100644
index 00000000..e4a97573
--- /dev/null
+++ b/app/src/main/java/com/hippo/ehviewer/client/ECH.kt
@@ -0,0 +1,61 @@
+package com.hippo.ehviewer.client
+
+import android.util.Log
+import java.util.Base64
+import javax.net.ssl.SSLSocket
+import okhttp3.Interceptor
+import okhttp3.Response
+import org.conscrypt.Conscrypt
+import org.conscrypt.EchRejectedException
+import org.xbill.DNS.Lookup
+import org.xbill.DNS.SimpleResolver
+import org.xbill.DNS.Type
+
+private const val OUTER_SNI = "cloudflare-ech.com"
+private const val DEFAULT_TTL = 300L
+private val RESOLVER = SimpleResolver("common.dot.dns.yandex.net")
+private var ttl: Long? = null
+private var expirationTime: Long = 0
+var cachedEchConfig: ByteArray? = null
+
+fun loadCachedEchConfig(): ByteArray? = cachedEchConfig?.takeIf { System.currentTimeMillis() < expirationTime }?.also {
+    Log.d("ECH", "Cache hit, TTL ${expirationTime - System.currentTimeMillis()}ms left")
+}
+
+fun logEchConfigList(socket: SSLSocket, host: String) {
+    Conscrypt.getEchConfigList(socket)?.also { echConfigList ->
+        Log.d("ECH", "ECH Config List (${echConfigList.size} bytes) for $host:")
+        Log.d("ECH", Base64.getEncoder().encodeToString(echConfigList))
+    }
+}
+
+fun fetchAndCacheEchConfig() {
+    runCatching {
+        val lookup = Lookup(OUTER_SNI, Type.HTTPS).apply { setResolver(RESOLVER) }
+        val records = lookup.run()
+        val record = records?.firstOrNull() ?: return@runCatching
+        ttl = record.ttl
+        val result = record.rdataToString()
+        Log.d("ECH", "Response for $OUTER_SNI is $result, TTL ${ttl ?: DEFAULT_TTL}")
+        val echConfig = Regex("ech=([A-Za-z0-9+/=]+)")
+            .find(result)
+            ?.groupValues?.get(1)
+            ?.let { Base64.getDecoder().decode(it) }
+            ?: return@runCatching
+        cachedEchConfig = echConfig
+        expirationTime = System.currentTimeMillis() + (ttl ?: DEFAULT_TTL) * 1000
+    }.onFailure {
+        Log.w("ECH", "Failed to fetch ECH config", it)
+    }
+}
+
+class EchRejectedExceptionInterceptor : Interceptor {
+
+    override fun intercept(chain: Interceptor.Chain): Response = try {
+        chain.proceed(chain.request())
+    } catch (e: EchRejectedException) {
+        Log.d("ECH", "Resetting expirationTime")
+        expirationTime = 0
+        throw e
+    }
+}
diff --git a/app/src/main/java/com/hippo/ehviewer/client/EhDns.kt b/app/src/main/java/com/hippo/ehviewer/client/EhDns.kt
new file mode 100644
index 00000000..66e2d708
--- /dev/null
+++ b/app/src/main/java/com/hippo/ehviewer/client/EhDns.kt
@@ -0,0 +1,18 @@
+package com.hippo.ehviewer.client
+
+import java.net.InetAddress
+import okhttp3.Dns
+
+object EhDns : Dns {
+    const val CFSUFFIX = ".cdn.cloudflare.net"
+
+    override fun lookup(hostname: String): List<InetAddress> {
+        if (hostname.endsWith("e-hentai.org")) {
+            return Dns.SYSTEM.lookup("e-hentai.org$CFSUFFIX")
+        }
+        if (hostname.endsWith("exhentai.org")) {
+            return Dns.SYSTEM.lookup("exhentai.org$CFSUFFIX")
+        }
+        return Dns.SYSTEM.lookup(hostname)
+    }
+}
diff --git a/app/src/main/java/com/hippo/ehviewer/client/EhSSLSocketFactory.kt b/app/src/main/java/com/hippo/ehviewer/client/EhSSLSocketFactory.kt
new file mode 100644
index 00000000..4dfbbe49
--- /dev/null
+++ b/app/src/main/java/com/hippo/ehviewer/client/EhSSLSocketFactory.kt
@@ -0,0 +1,75 @@
+package com.hippo.ehviewer.client
+
+import com.hippo.ehviewer.EhApplication
+import java.net.InetAddress
+import java.net.Proxy
+import java.net.Socket
+import java.net.URI
+import javax.net.ssl.SSLSocket
+import javax.net.ssl.SSLSocketFactory
+import kotlinx.coroutines.runBlocking
+import org.conscrypt.Conscrypt
+
+class EhSSLSocketFactory(val factory: SSLSocketFactory) : SSLSocketFactory() {
+
+    override fun createSocket(s: Socket, host: String, port: Int, autoClose: Boolean): Socket {
+        val noProxy = EhApplication.ehProxySelector.select(URI("https://$host"))[0] == Proxy.NO_PROXY
+        val socket = factory.createSocket(
+            s,
+            host,
+            port,
+            autoClose,
+        ) as SSLSocket
+        return configureSocket(socket, host)
+    }
+
+    override fun createSocket(host: String, port: Int): Socket = configureSocket(
+        factory.createSocket(host, port) as SSLSocket,
+        host,
+    )
+
+    override fun createSocket(
+        host: String,
+        port: Int,
+        localHost: InetAddress?,
+        localPort: Int,
+    ): Socket = configureSocket(
+        factory.createSocket(host, port, localHost, localPort) as SSLSocket,
+        host,
+    )
+
+    override fun createSocket(host: InetAddress, port: Int): Socket = factory.createSocket(host, port)
+
+    override fun createSocket(
+        address: InetAddress,
+        port: Int,
+        localAddress: InetAddress?,
+        localPort: Int,
+    ): Socket = factory.createSocket(address, port, localAddress, localPort)
+
+    override fun getDefaultCipherSuites(): Array<String> = factory.defaultCipherSuites
+
+    override fun getSupportedCipherSuites(): Array<String> = factory.supportedCipherSuites
+
+    private fun configureSocket(
+        socket: SSLSocket,
+        host: String,
+    ): SSLSocket {
+        Conscrypt.setCheckDnsForEch(socket, false)
+        if (host.endsWith("e-hentai.org") or
+            host.endsWith("exhentai.org")
+        ) {
+            Conscrypt.getEchConfigList(socket) ?: run {
+                loadCachedEchConfig() ?: run {
+                    runBlocking {
+                        fetchAndCacheEchConfig()
+                    }
+                }
+                Conscrypt.setEchConfigList(socket, cachedEchConfig)
+            }
+            logEchConfigList(socket, host)
+        }
+
+        return socket
+    }
+}
